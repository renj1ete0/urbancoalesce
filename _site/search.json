[
  {
    "objectID": "explore/167_OD_analysis.html",
    "href": "explore/167_OD_analysis.html",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "",
    "text": "Danger\n\n\n\nThis article and analysis is a work-in-progress! Please read and interpret results at your own risk, check back for the final article!\nNote: There is some inaccuracies with the original dataset provided by LTA on 24/4/2024, any analysis prior to 24/2/2024 may derive inaccurate conclusions"
  },
  {
    "objectID": "explore/167_OD_analysis.html#background",
    "href": "explore/167_OD_analysis.html#background",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "2.1 Background",
    "text": "2.1 Background\nWith the introduction of Thomson East Coast Line 3 between Caldecott and Gardens by the Bay stations on DD/MM/YYYY, bridging the Upper Thomson area towards the city, the Land Transport Authority of Singapore (LTA) sought to reduce duplication of bus routes with new train lines, which was common practice in Singapore.\nThe announcement by the LTA to rationalise bus service 167 came with much negative response"
  },
  {
    "objectID": "explore/167_OD_analysis.html#objectives",
    "href": "explore/167_OD_analysis.html#objectives",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "2.2 Objectives",
    "text": "2.2 Objectives\nUnderstand more about the initial failure of the route rationalisation of bus service 167:\n\nCommuters perspective\nWhy a hub-and-spoke approach (with the introduction of Thomson East Coast Line) is insufficient to shift demand? [pending analysis]\n\nClick here to skip to the analysis"
  },
  {
    "objectID": "explore/167_OD_analysis.html#setting-up",
    "href": "explore/167_OD_analysis.html#setting-up",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "3.1 Setting Up",
    "text": "3.1 Setting Up\nPackages required to be loaded for\n\npacman::p_load(dplyr, readr, sf, tidyverse, tmap, sfdep, ggpubr, Metrics, ggplot2, plotly, spdep, rjson, od, gifski, stplanr)"
  },
  {
    "objectID": "explore/167_OD_analysis.html#data-sources",
    "href": "explore/167_OD_analysis.html#data-sources",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "3.2 Data Sources",
    "text": "3.2 Data Sources\n\n\n\nDataset Name\nSource\nMethodology\n\n\n\n\nOrigin-Destination Passenger Count for Buses (OD) Nov 2023\nLTA Datamall\nAPI\n\n\nBus Routes as of 26 Nov 2023\nLTA Datamall\nAPI\n\n\nBus Stops as of 26 Nov 2023\nLTA Datamall\nAPI"
  },
  {
    "objectID": "explore/167_OD_analysis.html#loading-data",
    "href": "explore/167_OD_analysis.html#loading-data",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "4.1 Loading Data",
    "text": "4.1 Loading Data\nLoading the Origin-Destination Passenger Count for Buses\n\nRAW_OD_2019_11 <- read.csv(\"D:/167_OD_analysis/origin_destination_bus_201911.csv\")\nRAW_OD_2021_07 <- read.csv(\"D:/167_OD_analysis/origin_destination_bus_202211.csv\")\nRAW_OD_2022_08 <- read.csv(\"D:/167_OD_analysis/origin_destination_bus_202211.csv\")\nRAW_OD_2022_11 <- read.csv(\"D:/167_OD_analysis/origin_destination_bus_202211.csv\")\nRAW_OD_2023_11 <- read.csv(\"D:/167_OD_analysis/origin_destination_bus_202311.csv\")\n\nLoading the Bus Routes JSON file:\n\nBUS_ROUTE <- fromJSON(file=\"D:/167_OD_analysis/busroute_2023-11-26.json\")\nBUS_ROUTE_2021_07 <- fromJSON(file=\"D:/167_OD_analysis/busroute_2021-07.json\")\n\nLoading the Bus Stops JSON file:\n\nBUS_STOP <- fromJSON(file=\"D:/167_OD_analysis/busstop_2023-11-26.json\")\n\nLoading the Bus Service JSON file:\n\nBUS_SERVICE <- fromJSON(file=\"D:/167_OD_analysis/busservice_2023-11-26.json\")\nBUS_SERVICE_2021_07 <- fromJSON(file=\"D:/167_OD_analysis/busservice_2021-07.json\")\n\nLoad MPSZ (2019):\n\nmpsz <- st_read(dsn = \"D:/167_OD_analysis/\",\n                   layer = \"MPSZ-2019\") %>%\n  st_transform(crs = 3414)\n\nReading layer `MPSZ-2019' from data source `D:\\167_OD_analysis' using driver `ESRI Shapefile'\nSimple feature collection with 332 features and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nGeodetic CRS:  WGS 84"
  },
  {
    "objectID": "explore/167_OD_analysis.html#define-static-variables",
    "href": "explore/167_OD_analysis.html#define-static-variables",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "4.2 Define Static Variables",
    "text": "4.2 Define Static Variables\n\n4.2.1 Normalise Data\nAs the OD data from LTA sums trips from entire month, we need to normalise them to trips per day for ease of comparison between Weekdays, Saturdays and Sun_PH.\nWe first define the standard month information before executing the normalisation operations.\n\nWEEKDAY_OF_MONTH = 21\nSUN_PH_OF_MONTH = 5\nSAT_OF_MONTH = 4\nWEEKEND_OF_MONTH = SUN_PH_OF_MONTH + SAT_OF_MONTH\nOD_2023_11 <- RAW_OD_2023_11 %>% mutate(TOTAL_TRIPS = ifelse(DAY_TYPE==\"WEEKENDS/HOLIDAY\", TOTAL_TRIPS / WEEKEND_OF_MONTH, TOTAL_TRIPS / WEEKDAY_OF_MONTH ))\n\n\nWEEKDAY_OF_MONTH = 22\nSUN_PH_OF_MONTH = 4\nSAT_OF_MONTH = 4\nWEEKEND_OF_MONTH = SUN_PH_OF_MONTH + SAT_OF_MONTH\nOD_2022_11 <- RAW_OD_2022_11 %>% mutate(TOTAL_TRIPS = ifelse(DAY_TYPE==\"WEEKENDS/HOLIDAY\", TOTAL_TRIPS / WEEKEND_OF_MONTH, TOTAL_TRIPS / WEEKDAY_OF_MONTH ))\n\n\nWEEKDAY_OF_MONTH = 21\nSUN_PH_OF_MONTH = 5\nSAT_OF_MONTH = 5\nWEEKEND_OF_MONTH = SUN_PH_OF_MONTH + SAT_OF_MONTH\nOD_2021_07 <- RAW_OD_2021_07 %>% mutate(TOTAL_TRIPS = ifelse(DAY_TYPE==\"WEEKENDS/HOLIDAY\", TOTAL_TRIPS / WEEKEND_OF_MONTH, TOTAL_TRIPS / WEEKDAY_OF_MONTH ))\n\n\nWEEKDAY_OF_MONTH = 22\nSUN_PH_OF_MONTH = 4\nSAT_OF_MONTH = 4\nWEEKEND_OF_MONTH = SUN_PH_OF_MONTH + SAT_OF_MONTH\nOD_2022_08 <- RAW_OD_2022_08 %>% mutate(TOTAL_TRIPS = ifelse(DAY_TYPE==\"WEEKENDS/HOLIDAY\", TOTAL_TRIPS / WEEKEND_OF_MONTH, TOTAL_TRIPS / WEEKDAY_OF_MONTH ))\n\n\nWEEKDAY_OF_MONTH = 21\nSUN_PH_OF_MONTH = 4\nSAT_OF_MONTH = 5\nWEEKEND_OF_MONTH = SUN_PH_OF_MONTH + SAT_OF_MONTH\nOD_2019_11 <- RAW_OD_2019_11 %>% mutate(TOTAL_TRIPS = ifelse(DAY_TYPE==\"WEEKENDS/HOLIDAY\", TOTAL_TRIPS / WEEKEND_OF_MONTH, TOTAL_TRIPS / WEEKDAY_OF_MONTH ))"
  },
  {
    "objectID": "explore/167_OD_analysis.html#extracting-relevant-information",
    "href": "explore/167_OD_analysis.html#extracting-relevant-information",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "4.3 Extracting Relevant Information",
    "text": "4.3 Extracting Relevant Information\nFor the OD Passenger Count, we are only interested in obtaining counts which involves bus service 167. We will need to extract it twice, once for each direction.\nWe are not implementing a check for stops since the JSON data from LTA Datamall is returned in stop sequence.\n\n4.3.1 Extract 167 Bus Stops\n\n\n\n\n\n\nNote\n\n\n\nAs LTA’s OD Count stores CBD area bus stops starting with 0 as 4 digit codes instead of 5 digit prefixed with 0, we recode the bus stops as numeric and drop the ‘0’ prefix\n\n\n\nBS_167_DIR_1_DF <- data.frame(Seq =  integer(), BS_Code = integer())\nBS_167_DIR_2_DF <- data.frame(Seq =  integer(), BS_Code = integer())\n\nfor (route_info in BUS_ROUTE){\n  if (route_info$ServiceNo == \"167\"){\n    if (route_info$Direction == 1){\n      BS_167_DIR_1_temp <- data.frame(Seq = as.numeric(route_info$StopSequence), BS_Code = as.numeric(route_info$BusStopCode))\n      BS_167_DIR_1_DF[nrow(BS_167_DIR_1_DF) +1,] <- BS_167_DIR_1_temp\n    }\n    else if (route_info$Direction == 2){\n      BS_167_DIR_2_temp <- data.frame(Seq = as.numeric(route_info$StopSequence), BS_Code = as.numeric(route_info$BusStopCode))\n      BS_167_DIR_2_DF[nrow(BS_167_DIR_2_DF) +1,] <- BS_167_DIR_2_temp  \n    }\n  }\n}\n\nrm(BS_167_DIR_1_temp)\nrm(BS_167_DIR_2_temp)\n\n\n\n4.3.2 Append Bus Stop Names to DataFrame\nWe convert the List format of Bus Stops to a more workable DataFrame format\n\nBUS_STOP_DF <- data.frame(BS_Code = integer(), BS_Road_Name = character(), BS_Name = character(), Latitude = double(), Longitude = double())\nfor (bs in BUS_STOP){\n  BS_TEMP <- data.frame(BS_Code = as.numeric(bs$BusStopCode), BS_Road_Name = bs$RoadName, BS_Name = bs$Description, Latitude = as.numeric(bs$Latitude), Longitude = as.numeric(bs$Longitude))\n  BUS_STOP_DF[nrow(BUS_STOP_DF) +1,] <- BS_TEMP  \n}\nrm(BS_TEMP)\n\nWe then do a left join, merging the bus stop info into Bus Service direction DataFrames\n\nBS_167_DIR_1_DF <- merge(x=BS_167_DIR_1_DF,y=BUS_STOP_DF, \n             by=\"BS_Code\", all.x=TRUE)\nBS_167_DIR_2_DF <- merge(x=BS_167_DIR_2_DF,y=BUS_STOP_DF, \n             by=\"BS_Code\", all.x=TRUE)\n\n\n\n4.3.3 Reset Row Index Numbering\n\nrownames(BS_167_DIR_1_DF) <- BS_167_DIR_1_DF$Seq\nrownames(BS_167_DIR_2_DF) <- BS_167_DIR_2_DF$Seq\n\n\n\n4.3.4 Extract OD Passenger Count Related to 167\nExtracting the Direction 1 OD Data\n202206\n\nOD_2019_11_DIR1 <- OD_2019_11 %>% filter(OD_2019_11$ORIGIN_PT_CODE %in% BS_167_DIR_1_DF$BS_Code & OD_2019_11$DESTINATION_PT_CODE %in% BS_167_DIR_1_DF$BS_Code)\n\nOD_2019_11_DIR1 <- left_join(OD_2019_11_DIR1, BS_167_DIR_1_DF[1:2], by=c(\"ORIGIN_PT_CODE\" = \"BS_Code\")) %>% rename(OriginSeq = Seq)\nOD_2019_11_DIR1 <- left_join(OD_2019_11_DIR1, BS_167_DIR_1_DF[1:2], by=c(\"DESTINATION_PT_CODE\" = \"BS_Code\")) %>% rename(DestSeq = Seq)\nOD_2019_11_DIR1 <- OD_2019_11_DIR1 %>% filter(OriginSeq < DestSeq)\nOD_2019_11_DIR1 <- OD_2019_11_DIR1[1:7]\n\n2023\n\nOD_2023_11_DIR1 <- OD_2023_11 %>% filter(OD_2023_11$ORIGIN_PT_CODE %in% BS_167_DIR_1_DF$BS_Code & OD_2023_11$DESTINATION_PT_CODE %in% BS_167_DIR_1_DF$BS_Code)\n\nOD_2023_11_DIR1 <- left_join(OD_2023_11_DIR1, BS_167_DIR_1_DF[1:2], by=c(\"ORIGIN_PT_CODE\" = \"BS_Code\")) %>% rename(OriginSeq = Seq)\nOD_2023_11_DIR1 <- left_join(OD_2023_11_DIR1, BS_167_DIR_1_DF[1:2], by=c(\"DESTINATION_PT_CODE\" = \"BS_Code\")) %>% rename(DestSeq = Seq)\nOD_2023_11_DIR1 <- OD_2023_11_DIR1 %>% filter(OriginSeq < DestSeq)\nOD_2023_11_DIR1 <- OD_2023_11_DIR1[1:7]\n\nJust to check if the number of bus stops extracted matches the number of stops we have\n\nnum_stops_OD_1 <- n_distinct(OD_2023_11_DIR1$ORIGIN_PT_CODE)\nnum_stops_OD_1\n\n[1] 70\n\nnrow(BS_167_DIR_1_DF)\n\n[1] 71\n\nnum_stops_OD_1 == nrow(BS_167_DIR_1_DF)\n\n[1] FALSE\n\nnum_stops_OD_1 <- n_distinct(OD_2023_11_DIR1$ORIGIN_PT_CODE)\nnum_stops_OD_1\n\n[1] 70\n\nnum_stops_OD_1 == nrow(BS_167_DIR_1_DF)\n\n[1] FALSE\n\n\nExtracting the Direction 2 OD Data\n\nOD_2023_11_DIR2 <- OD_2023_11 %>% filter(OD_2023_11$ORIGIN_PT_CODE %in% BS_167_DIR_2_DF$BS_Code & OD_2023_11$DESTINATION_PT_CODE %in% BS_167_DIR_2_DF$BS_Code)\n\nOD_2023_11_DIR2 <- left_join(OD_2023_11_DIR2, BS_167_DIR_2_DF[1:2], by=c(\"ORIGIN_PT_CODE\" = \"BS_Code\")) %>% rename(OriginSeq = Seq)\nOD_2023_11_DIR2 <- left_join(OD_2023_11_DIR2, BS_167_DIR_2_DF[1:2], by=c(\"DESTINATION_PT_CODE\" = \"BS_Code\")) %>% rename(DestSeq = Seq)\nOD_2023_11_DIR2 <- OD_2023_11_DIR2 %>% filter(OriginSeq < DestSeq)\nOD_2023_11_DIR2 <- OD_2023_11_DIR2[1:7]\n\nJust to check if the number of bus stops extracted matches the number of stops we have\n\nnum_stops_OD_2 <- n_distinct(OD_2023_11_DIR2$ORIGIN_PT_CODE)\nnum_stops_OD_2\n\n[1] 68\n\nnum_stops_OD_2 == nrow(BS_167_DIR_2_DF)\n\n[1] FALSE\n\n\n\n\n4.3.5 Extract Bus Route Info to DataFrame\nWe save information that is required for our analysis from JSON to DataFrame format\n\nBUS_ROUTE_DF <- data.frame(Service_No = character(), Direction = integer(), Seq = integer(), BS_Code = integer(), Distance = double(), WD_FirstBus = integer(), WD_LastBus = integer(), SAT_FirstBus = integer(), SAT_LastBus = integer(), SUN_FirstBus = integer(), SUN_LastBus = integer())\nfor (route in BUS_ROUTE){\n  BS_RT_TEMP <- data.frame(ServiceNo = route$ServiceNo, Direction = as.numeric(route$Direction), Seq = as.numeric(route$StopSequence), BS_Code = as.numeric(route$BusStopCode), Distance = as.numeric(route$Distance), WD_FirstBus = as.numeric(route$WD_FirstBus), WD_LastBus = as.numeric(route$WD_LastBus), SAT_FirstBus = as.numeric(route$SAT_FirstBus), SAT_LastBus = as.numeric(route$SAT_LastBus), SUN_FirstBus = as.numeric(route$SUN_FirstBus), SUN_LastBus = as.numeric(route$SUN_LastBus))\n  BUS_ROUTE_DF[nrow(BUS_ROUTE_DF) +1,] <- BS_RT_TEMP  \n}\nrm(BS_RT_TEMP)\n\n\nBUS_ROUTE_2021_07_DF <- data.frame(Service_No = character(), Direction = integer(), Seq = integer(), BS_Code = integer(), Distance = double(), WD_FirstBus = integer(), WD_LastBus = integer(), SAT_FirstBus = integer(), SAT_LastBus = integer(), SUN_FirstBus = integer(), SUN_LastBus = integer())\nfor (route in BUS_ROUTE_2021_07){\n\n  BS_RT_TEMP <- data.frame(ServiceNo = route$ServiceNo, Direction = as.numeric(route$Direction), Seq = as.numeric(route$StopSequence), BS_Code = as.numeric(route$BusStopCode), Distance = as.numeric(route$Distance), WD_FirstBus = as.numeric(route$WD_FirstBus), WD_LastBus = as.numeric(route$WD_LastBus), SAT_FirstBus = as.numeric(route$SAT_FirstBus), SAT_LastBus = as.numeric(route$SAT_LastBus), SUN_FirstBus = as.numeric(route$SUN_FirstBus), SUN_LastBus = as.numeric(route$SUN_LastBus))\n  BUS_ROUTE_2021_07_DF[nrow(BUS_ROUTE_2021_07_DF) +1,] <- BS_RT_TEMP  \n}\n\nBUS_ROUTE_2021_07_DF <- unique(BUS_ROUTE_2021_07_DF)\nrm(BS_RT_TEMP)\n\n\n\n4.3.6 Extract Bus Service Info to DataFrame\n\nPROCESS_BUS_SVC_DF <- function(BUS_SERVICE){\n    BUS_SVC_DF <- data.frame(Service_No = character(), Direction = integer(), Category = character(), AM_Peak_Freq = character(), AM_OffPeak_Freq = character(), PM_Peak_Freq = character(), PM_OffPeak_Freq = character(), LoopDesc = character())\n  for (svc in BUS_SERVICE){\n    BS_SVC_TEMP <- data.frame(Service_No = svc$ServiceNo, Direction = as.numeric(svc$Direction), Category = svc$Category, AM_Peak_Freq = svc$AM_Peak_Freq, AM_OffPeak_Freq = svc$AM_Offpeak_Freq, PM_OffPeak_Freq = svc$PM_Offpeak_Freq, PM_Peak_Freq = svc$PM_Peak_Freq, LoopDesc = svc$LoopDesc)\n    \n    # data appears to have duplicated fields\n    if (nrow(BUS_SVC_DF %>% filter(Service_No == BS_SVC_TEMP$Service_No & Direction == BS_SVC_TEMP$Direction)) == 0) {\n        BUS_SVC_DF[nrow(BUS_SVC_DF) +1,] <- BS_SVC_TEMP  \n    }\n  }\n    \n    return (BUS_SVC_DF)\n}\n\n\nBUS_SVC_DF <- PROCESS_BUS_SVC_DF(BUS_SERVICE)\nBUS_SVC_2021_07_DF <- PROCESS_BUS_SVC_DF(BUS_SERVICE_2021_07)\n\n\n\n4.3.7 Discard Unneeded Variables\n\nrm(BUS_ROUTE)\nrm(BUS_SERVICE)\nrm(BUS_SERVICE_2021_07)\nrm(route)\nrm(svc)\nrm(bs)\nrm(route_info)\nrm(RAW_OD_2021_07)\nrm(RAW_OD_2022_08)\nrm(RAW_OD_2022_11)\nrm(RAW_OD_2023_11)\nrm(RAW_OD_2019_11)\nrm(BUS_ROUTE_2021_07)"
  },
  {
    "objectID": "explore/167_OD_analysis.html#normalisation-of-values",
    "href": "explore/167_OD_analysis.html#normalisation-of-values",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "6.1 Normalisation of values",
    "text": "6.1 Normalisation of values\nOD Matrix shows flows between pairs of bus stops. For bus stop pairs served by different services, they will contribute to the same OD count.\nThis is especially evident in certain bus stop pairs, such as BS 40189 Newton Stn Exit B to BS 09219 Far East Plaza, amongst others, where commuters would likely hop on any of the many buses along the road.\n\n6.1.0.1 Methodology\nWe will use this formula in calculating and estimating the OD flows for 167 bus stops using this formula below.\n<insert latex formula>\nBus Per Hour (BPH) for given service at given hour = 60 / Average Frequency at given timing for the given service*\n* if given service operates at 8 - 12 min during AM Peak, 10 minutes will be used, hence, computing a 10 min interval between buses and 6 buses per hour (bph)\nFlow between OD Pair for a given service at given hour = Total Flow between OD Pair at given hr x (BPH for given service at given hour / Sum of BPH on all services servicing between OD Pair at given hr) ^\n\n\n6.1.0.2 ^ Rules\n\nTrip distance of services shall not exceed 3km of mean distance of all services between the OD pair for normal services (non-express)\n\nIf services takes a large detour, we assume that passengers will not be inclined to take the detour of services since its longer\n\nExclusion of services that charges express fares (Express or City Direct) if OD pair is less than 5km (ie. shorter than ‘express’ sector)\n\nIssues with assumptions:\n\nAssumes uniform distribution across all services\nFor express services with express sectors, it is hard to estimate the split of passengers taking normal and express services - Assumption will be that they are equal\n\n\n\n6.1.0.3 Computing\nAs LTA’s data does not provide a differentiation for bus frequencies on weekdays and weekends, we will take the average time between the intervals provided\nAdditionally, we will derive the frequencies as follows:\n\nFor the following timings below, LTA’s definition will be used, we will use the average of the frequency band provided:\n\nAM Peak - 0630h to 0830h\nAM Off Peak - 0831h to 1659h\nPM Peak - 1700h to 1900h\nPM Off Peak - after 1900h\n\nFor the following timings below:\n\nFrom start of service to 0630h - We take upper limit of AM Peak frequency\n\n\n\nnorm_bph_checker <- function(bph, BUS_SVC, DIR, BS_CODE_ORIGIN){\n  \n  if (is.na(bph)){\n    print(BUS_SVC)\n    print(DIR)\n    print(BS_CODE_ORIGIN)\n    bph <- 0 #if unable to determine, zero the bph, fix this later\n    return (bph)\n  }\n  \n  return (bph)\n  \n}\n\nnorm_bph <- function(BUS_SVC, DIR, HOUR, NUM_DAY_OF_WEEK, BS_CODE_ORIGIN, BS_SEQ_ORIGIN, INPUT_BUS_SVC_DF, BUS_ROUTE_DF){\n  # check operational\n  if (HOUR < 3){\n    HOUR <- HOUR + 24\n    if (NUM_DAY_OF_WEEK > 1){\n      NUM_DAY_OF_WEEK <- NUM_DAY_OF_WEEK - 1\n    }\n    else{\n      NUM_DAY_OF_WEEK <- 7\n    }\n  }\n  \n  total_time <- norm_bph_bs_operational(BUS_SVC, DIR, HOUR, NUM_DAY_OF_WEEK, BS_CODE_ORIGIN, BS_SEQ_ORIGIN, BUS_ROUTE_DF)\n  if (total_time == -1){\n    return (0)\n  }\n  else {\n \n    SEL_BUS_SVC <- INPUT_BUS_SVC_DF %>% filter(Service_No == BUS_SVC & Direction == DIR)\n\n    if (HOUR >= 19){\n      # Legacy code has '15' instead of '15-15'\n      if (grepl(\"-\", SEL_BUS_SVC$PM_OffPeak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$PM_OffPeak_Freq, \"-\")\n        freq <- (as.numeric(time[[1]][1]) + as.numeric(time[[1]][2])) / 2\n      }\n      else{\n        freq = as.numeric(SEL_BUS_SVC$PM_OffPeak_Freq)\n      }\n      \n      bph <- total_time / freq\n      bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n    }\n    else if(HOUR >= 17 && HOUR < 19){\n      \n      if (grepl(\"-\", SEL_BUS_SVC$PM_Peak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$PM_Peak_Freq, \"-\")\n        freq <- (as.numeric(time[[1]][1]) + as.numeric(time[[1]][2])) / 2      \n      }\n      else{\n        freq = as.numeric(SEL_BUS_SVC$PM_Peak_Freq)\n      }\n      bph <- total_time / freq\n      bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n    }\n    else if(HOUR >= 9 && HOUR < 17){\n      \n      if (grepl(\"-\", SEL_BUS_SVC$AM_OffPeak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$AM_OffPeak_Freq, \"-\")\n        freq <- (as.numeric(time[[1]][1]) + as.numeric(time[[1]][2])) / 2\n      }\n      else{\n        freq = as.numeric(SEL_BUS_SVC$AM_OffPeak_Freq)\n      }\n      \n      bph <- total_time / freq\n      bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n    }    \n    else if(HOUR == 8){\n      \n      if (grepl(\"-\", SEL_BUS_SVC$AM_Peak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$AM_Peak_Freq, \"-\")\n        freq1 <- (as.numeric(time[[1]][1]) + as.numeric(time[[1]][2])) / 2\n      }\n      else{\n        freq1 = as.numeric(SEL_BUS_SVC$AM_Peak_Freq)\n      }\n      \n      if (grepl(\"-\", SEL_BUS_SVC$AM_OffPeak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$AM_OffPeak_Freq, \"-\")\n        freq2 <- (as.numeric(time[[1]][1]) + as.numeric(time[[1]][2])) / 2\n      }\n      else{\n        freq2 = as.numeric(SEL_BUS_SVC$AM_OffPeak_Freq)\n      }\n      \n      if (total_time <= 30){\n        bph <- total_time / freq1\n        bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n      }\n      else{\n        temp_bph <- total_time / freq1\n        bph <- ((((total_time - 30) / freq2) + temp_bph) / 2)\n        bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n      }\n    }        \n    else if(HOUR == 7){\n      if (grepl(\"-\", SEL_BUS_SVC$AM_Peak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$AM_Peak_Freq, \"-\")\n        freq <- (as.numeric(time[[1]][1]) + as.numeric(time[[1]][2])) / 2\n      }\n      else{\n        freq = as.numeric(SEL_BUS_SVC$AM_Peak_Freq)\n      }\n\n      bph <- total_time / freq\n      \n      bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n    }  \n    else if(HOUR == 6){\n      \n      if (grepl(\"-\", SEL_BUS_SVC$AM_Peak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$AM_Peak_Freq, \"-\")\n        freq1 <- as.numeric(time[[1]][2])\n      }\n      else{\n        freq1 = as.numeric(SEL_BUS_SVC$AM_Peak_Freq)\n      }\n      \n      if (grepl(\"-\", SEL_BUS_SVC$AM_Peak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$AM_Peak_Freq, \"-\")\n        freq2 <- (as.numeric(time[[1]][1]) + as.numeric(time[[1]][2])) / 2\n      }\n      else{\n        freq2 = as.numeric(SEL_BUS_SVC$AM_Peak_Freq)\n      }\n    \n      if (total_time <= 30){\n        bph <- total_time / freq1\n        bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n      }\n      else{\n        temp_bph <- total_time / freq1\n        bph <- ((((total_time - 30) / freq2) + temp_bph) / 2)\n        bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n\n      }\n    }  \n    else if(HOUR >= 4 && HOUR < 6){\n      \n      if (grepl(\"-\", SEL_BUS_SVC$AM_Peak_Freq)){\n        time <- strsplit(SEL_BUS_SVC$AM_Peak_Freq, \"-\")\n        freq <- as.numeric(time[[1]][2])\n      }\n      else{\n        freq = as.numeric(SEL_BUS_SVC$AM_Peak_Freq)\n      }\n      \n      bph <- total_time / freq\n      bph <- norm_bph_checker(bph, BUS_SVC, DIR, BS_CODE_ORIGIN)\n    }  \n    return (bph)\n    \n  }\n  \n}\n\nnorm_bph_bs_operational <- function(BUS_SVC, DIR, HOUR, NUM_DAY_OF_WEEK, BS_CODE_ORIGIN, BS_SEQ_ORIGIN, BUS_ROUTE_DF){\n  # BS_SEQ_ORIGIN verifies that it is the correct bus stop (eg. starting stop instead of ending terminus)\n  SEL_BUS_ROUTE <- BUS_ROUTE_DF %>% filter(Service_No == BUS_SVC & BS_Code == BS_CODE_ORIGIN & Direction == DIR & Seq == BS_SEQ_ORIGIN)\n  temp_timing <- -1\n  if (NUM_DAY_OF_WEEK > 0 & NUM_DAY_OF_WEEK < 6){\n    if (is.na(SEL_BUS_ROUTE$WD_FirstBus)){\n      return (-1)\n    }\n    if (SEL_BUS_ROUTE$WD_LastBus < 3 * 100){\n      WD_LastBus <- 2400 + SEL_BUS_ROUTE$WD_LastBus\n    }\n    else{\n      WD_LastBus <- SEL_BUS_ROUTE$WD_LastBus\n    }\n    if ((SEL_BUS_ROUTE$WD_FirstBus < (as.numeric(HOUR) * 100)) && (WD_LastBus > as.numeric(HOUR) * 100)){\n      temp_timing <- WD_LastBus - as.numeric(HOUR) * 100 \n    }\n    else if ((SEL_BUS_ROUTE$WD_FirstBus == (as.numeric(HOUR) * 100)) && (WD_LastBus > as.numeric(HOUR) * 100)){\n      temp_timing <- as.numeric(HOUR) * 100 + 60 - SEL_BUS_ROUTE$WD_FirstBus\n    }\n    else if ((SEL_BUS_ROUTE$WD_FirstBus == (as.numeric(HOUR) * 100)) && (WD_LastBus == as.numeric(HOUR) * 100)){\n      temp_timing <- WD_LastBus - SEL_BUS_ROUTE$WD_FirstBus\n    }\n  } \n  else if (NUM_DAY_OF_WEEK == 6){\n    if (is.na(SEL_BUS_ROUTE$SAT_FirstBus)){\n      return (-1)\n    }\n    if (SEL_BUS_ROUTE$SAT_LastBus < 3 * 100){\n      Sat_LastBus <- 2400 + SEL_BUS_ROUTE$SAT_LastBus\n    }\n    else{\n      Sat_LastBus <- SEL_BUS_ROUTE$SAT_LastBus\n    }\n    if ((SEL_BUS_ROUTE$SAT_FirstBus < (as.numeric(HOUR) * 100)) && (Sat_LastBus > as.numeric(HOUR) * 100)){\n      temp_timing <- Sat_LastBus - as.numeric(HOUR) * 100\n    }\n    else if ((SEL_BUS_ROUTE$SAT_FirstBus == (as.numeric(HOUR) * 100)) && (Sat_LastBus > as.numeric(HOUR) * 100)){\n      temp_timing <- as.numeric(HOUR) * 100 + 60 - SEL_BUS_ROUTE$SAT_FirstBus\n    }\n    else if ((SEL_BUS_ROUTE$SAT_FirstBus == (as.numeric(HOUR) * 100)) && (Sat_LastBus == as.numeric(HOUR) * 100)){\n      temp_timing <- Sat_LastBus - SEL_BUS_ROUTE$SAT_FirstBus\n    }\n  } \n  else if (NUM_DAY_OF_WEEK == 7){\n    if (is.na(SEL_BUS_ROUTE$SUN_FirstBus)){\n      return (-1)\n    }\n    if (SEL_BUS_ROUTE$SUN_LastBus < 3 * 100){\n      Sun_LastBus <- 2400 + SEL_BUS_ROUTE$SUN_LastBus\n    }\n    else{\n      Sun_LastBus <- SEL_BUS_ROUTE$SUN_LastBus\n    }\n    if ((SEL_BUS_ROUTE$SUN_FirstBus < (as.numeric(HOUR) * 100)) && (Sun_LastBus > as.numeric(HOUR) * 100)){\n      temp_timing <- Sun_LastBus - as.numeric(HOUR) * 100\n    }\n    else if ((SEL_BUS_ROUTE$SUN_FirstBus == (as.numeric(HOUR) * 100)) && (Sun_LastBus > as.numeric(HOUR) * 100)){\n      temp_timing <- as.numeric(HOUR) * 100 + 60 - SEL_BUS_ROUTE$SUN_FirstBus\n    }\n    else if ((SEL_BUS_ROUTE$SUN_FirstBus == (as.numeric(HOUR) * 100)) && (Sun_LastBus == as.numeric(HOUR) * 100)){\n      temp_timing <- Sun_LastBus - SEL_BUS_ROUTE$SUN_FirstBus\n    }\n  }\n  \n  if (temp_timing > 60){\n    return (60)\n  }\n  else{\n    return (temp_timing)\n  }\n}\n\nnorm_common_bus_svcs <- function(BS_CODE_ORIGIN, BS_CODE_DEST, BUS_ROUTE_DF){\n  TEMP_BUS_ROUTE_DF <- BUS_ROUTE_DF[1:5]\n  # Filter ensures correct pairs are selected (in event of start/end stop same) and filters out inaccurate data where stops are recorded in reverse (eg. 167 Nov 8am Weekday data between 3218 and 3129)\n  TEMP_BUS_ROUTE_DF <- left_join(TEMP_BUS_ROUTE_DF, TEMP_BUS_ROUTE_DF, by=c(\"Service_No\", \"Direction\"), suffix=c(\"Origin\", \"Dest\"))\n  \n  TEMP_BUS_ROUTE_OD_PAIR <- TEMP_BUS_ROUTE_DF %>% filter(BS_CodeOrigin == BS_CODE_ORIGIN & BS_CodeDest == BS_CODE_DEST & SeqOrigin < SeqDest)\n  \n  return (TEMP_BUS_ROUTE_OD_PAIR)\n}\n\nnorm_verify_express <- function(BUS_SVC, DIR, INPUT_BUS_SVC_DF){\n  SEL_BUS_SVC <- INPUT_BUS_SVC_DF %>% filter(Service_No == BUS_SVC & DIR == Direction)\n  BUS_CAT <- c(\"CITY_LINK\", \"EXPRESS\")\n  if (SEL_BUS_SVC$Category %in% BUS_CAT){\n    return (FALSE)\n  }\n  return (TRUE)\n}\n\nnorm_calc_bph <- function(BS_CODE_ORIGIN, BS_CODE_DEST, HOUR, NUM_DAY_OF_WEEK, SVC, DIR, INPUT_BUS_SVC_DF, BUS_ROUTE_DF){\n  common_svcs <- norm_common_bus_svcs(BS_CODE_ORIGIN, BS_CODE_DEST, BUS_ROUTE_DF)\n  common_svcs <- common_svcs %>% mutate(mileage = DistanceDest - DistanceOrigin)\n  mean_mileage <- mean(common_svcs$mileage)\n  \n  bph_total <- 0\n  bph_svc <- 0\n  \n  # if no rows (ie. all invalid data, dont run bph)\n  if (nrow(common_svcs) > 0){\n    for (i in 1:nrow(common_svcs)) {\n      if (common_svcs[i,]$mileage <= mean_mileage + 3){\n        temp_bph <- norm_bph(common_svcs[i,]$Service_No, common_svcs[i,]$Direction, HOUR, NUM_DAY_OF_WEEK, BS_CODE_ORIGIN, common_svcs[i,]$SeqOrigin, INPUT_BUS_SVC_DF, BUS_ROUTE_DF)\n        if (common_svcs[i,]$Service_No == SVC){\n          bph_svc <- temp_bph\n          bph_total <- bph_total + temp_bph\n        }\n        # Let us verify for express service\n        else if (common_svcs[i,]$mileage <= 5){\n          if (norm_verify_express(common_svcs[i,]$Service_No, common_svcs[i,]$Direction, INPUT_BUS_SVC_DF)){\n            bph_total <- bph_total + temp_bph\n          }\n        }\n        else{\n          bph_total <- bph_total + temp_bph\n        }\n      }\n    }\n  }\n  \n  bph <- list(bph_svc, bph_total)\n  \n  return (bph)\n}\n\n\nnorm_flow_od <- function(FLOW, BS_CODE_ORIGIN, BS_CODE_DEST, HOUR, NUM_DAY_OF_WEEK, SVC, DIR, INPUT_BUS_SVC_DF, BUS_ROUTE_DF){\n  bph <- norm_calc_bph(BS_CODE_ORIGIN, BS_CODE_DEST, HOUR, NUM_DAY_OF_WEEK, SVC, DIR, INPUT_BUS_SVC_DF, BUS_ROUTE_DF)\n  bph_svc <- bph[[1]]\n  bph_total <- bph[[2]]\n  svc_flow <- FLOW * (bph_svc / bph_total)\n  if (is.nan(svc_flow)){\n    return (0)\n  }\n  return (svc_flow)\n}"
  },
  {
    "objectID": "explore/167_OD_analysis.html#generating-flows",
    "href": "explore/167_OD_analysis.html#generating-flows",
    "title": "Effects of Thomson East Coast Line on Bus Service 167",
    "section": "6.2 Generating Flows",
    "text": "6.2 Generating Flows\n\ngen_od_timing_flows <- function(input_OD, sf_bs, timing, INPUT_BUS_SVC_DF, BUS_ROUTE_DF){ \n  OD_TEST_DIR1 <- input_OD %>% filter(DAY_TYPE == \"WEEKDAY\" & TIME_PER_HOUR == timing)\n  \n  #norm_flow_od <- function(FLOW, BS_CODE_ORIGIN, BS_CODE_DEST, HOUR, NUM_DAY_OF_WEEK, SVC){\n  OD_TEST_DIR1 <- OD_TEST_DIR1 %>% rowwise() %>%  mutate(NORM_TRIPS = (norm_flow_od(TOTAL_TRIPS, ORIGIN_PT_CODE, DESTINATION_PT_CODE, TIME_PER_HOUR, 1, \"167\", 1, INPUT_BUS_SVC_DF, BUS_ROUTE_DF)))\n  \n  OD <- left_join(OD_TEST_DIR1 , sf_bs, by = c(\"ORIGIN_PT_CODE\" = \"BS_Code\")) %>% rename(ORIGIN_BS = ORIGIN_PT_CODE, ORIGIN_PA = PLN_AREA_C, DESTIN_BS = DESTINATION_PT_CODE)\n  \n  OD <- left_join(OD , sf_bs, by = c(\"DESTIN_BS\" = \"BS_Code\"))\n  \n  return (OD) \n}\n\ngen_od_timing_PA <- function(OD_PA){ \n\n    OD_PA <- OD_PA %>% rename(DESTIN_PA = PLN_AREA_C) %>% drop_na() %>% group_by(ORIGIN_PA, DESTIN_PA) %>% summarise(PA_TRIPS = sum(NORM_TRIPS))\n\nreturn (OD_PA) \n}\n\ngen_od_timing_PA_intra <- function(OD_PA){ \n  OD_PA_INTRA <- OD_PA[OD_PA$ORIGIN_PA!=OD_PA$DESTIN_PA,] \n  return (OD_PA_INTRA) \n}\n\ngen_od_timing_PA_inter <- function(OD_PA){ \n  OD_PA_INTER <- OD_PA[OD_PA$ORIGIN_PA==OD_PA$DESTIN_PA,] \n  return (OD_PA_INTER) \n}\n\ngen_od_timing_PA_flows <- function(OD_PA_INTRA){\n\nsf_OD_PA_INTRA_FLOWS <- od2line(flow = OD_PA_INTRA, zones = mpsz_pln_area, zone_code = \"PLN_AREA_C\")\n\nreturn (sf_OD_PA_INTRA_FLOWS) \n} \ntmap_plot_pa <- function(BS, OD) { \n  tmap_mode(\"view\") \n  tm_shape(mpsz_pln_area) + \n    tm_polygons(\"PLN_AREA_C\", legend.show = FALSE, palette=\"Set3\") + \n  tm_shape(BS) + \n    tm_dots(\"PLN_AREA_C\", scale = 1.3, legend.show = FALSE, palette=\"Set3\") + \n  #tm_shape(sf_BS_167_DIR_2) + \n    # tm_dots(col = \"blue\", scale = 2) + \n  tm_shape(OD) + \n    tm_lines(col = \"PA_TRIPS\", style=\"fixed\", breaks = c(0, 1, 5, 10, 15, 25, 50, 80, 130, 250), lwd = \"PA_TRIPS\", scale=20, palette=\"viridis\") \n} \n\nplot_trip_summary <- function(OD){ \n  summary(OD$NORM_TRIPS) \n  p <- ggplot(OD, aes(x=NORM_TRIPS)) + geom_histogram(binwidth=25) + xlim(0, 500) + ylim(0, 50)\n  ggplotly(p) \n}\n\nPre-generate results\n\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 6, BUS_SVC_DF, BUS_ROUTE_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_6.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 7, BUS_SVC_DF, BUS_ROUTE_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_7.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 8, BUS_SVC_DF, BUS_ROUTE_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_8.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 9, BUS_SVC_DF, BUS_ROUTE_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_9.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 10, BUS_SVC_DF, BUS_ROUTE_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_10.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 11, BUS_SVC_DF, BUS_ROUTE_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_11.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 12, BUS_SVC_DF, BUS_ROUTE_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_12.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 18, BUS_SVC_DF, BUS_ROUTE_DF)\n\n#saveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_18.rds\")\n#temp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 19, BUS_SVC_DF)\n#saveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_19.rds\")\n#temp_sf_pa <- gen_od_timing_flows(OD_2023_11_DIR1, BUS_STOP_DF_MPSZ, 20, BUS_SVC_DF)\n#saveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_norm_20.rds\")\n\n\ntemp_sf_pa <- gen_od_timing_flows(OD_2019_11_DIR1, BUS_STOP_DF_MPSZ, 6, BUS_SVC_2021_07_DF, BUS_ROUTE_2021_07_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_2019_11_norm_6.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2019_11_DIR1, BUS_STOP_DF_MPSZ, 7, BUS_SVC_2021_07_DF, BUS_ROUTE_2021_07_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_2019_11_norm_7.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2019_11_DIR1, BUS_STOP_DF_MPSZ, 8, BUS_SVC_2021_07_DF, BUS_ROUTE_2021_07_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_2019_11_norm_8.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2019_11_DIR1, BUS_STOP_DF_MPSZ, 9, BUS_SVC_2021_07_DF, BUS_ROUTE_2021_07_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_2019_11_norm_9.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2019_11_DIR1, BUS_STOP_DF_MPSZ, 10, BUS_SVC_2021_07_DF, BUS_ROUTE_2021_07_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_2019_11_norm_10.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2019_11_DIR1, BUS_STOP_DF_MPSZ, 11, BUS_SVC_2021_07_DF, BUS_ROUTE_2021_07_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_2019_11_norm_11.rds\")\ntemp_sf_pa <- gen_od_timing_flows(OD_2019_11_DIR1, BUS_STOP_DF_MPSZ, 12, BUS_SVC_2021_07_DF, BUS_ROUTE_2021_07_DF)\nsaveRDS(temp_sf_pa, \"D:/167_OD_Analysis/sf_2019_11_norm_12.rds\")\n\n\n6amjjjj7am8am9am10am11am12pm\n\n\n\ntmap_options(check.and.fix = TRUE)\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_norm_6.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA    PA_TRIPS\n1         YS        AM 54.74234771\n2         AM        BS 38.51508192\n3         SB        YS 25.77903551\n4         YS        BS 15.42857143\n5         YS        NV  9.19047619\n6         YS        TP  9.14285714\n7         SB        BS  6.19532364\n8         SB        TP  4.83033932\n9         SB        AM  4.21642429\n10        YS        OR  3.85714286\n11        SB        OR  3.61904762\n12        AM        TP  3.42857143\n13        YS        DT  3.28571429\n14        AM        OR  2.38095238\n15        AM        NV  2.28571429\n16        AM        DT  2.23809524\n17        SB        BM  1.76190476\n18        AM        MU  1.28571429\n19        YS        NT  1.28571429\n20        SB        NV  1.26603935\n21        SB        NT  0.85714286\n22        BS        TP  0.83564537\n23        YS        BM  0.80952381\n24        YS        MU  0.66666667\n25        BS        OR  0.55535831\n26        BS        DT  0.50757576\n27        SB        MU  0.33333333\n28        SB        DT  0.28571429\n29        AM        NT  0.19047619\n30        BS        NV  0.18881430\n31        AM        BM  0.04761905\n32        BS        MU  0.01839827\n33        BS        BM  0.00000000\n34        BS        NT  0.00000000\n35        DT        BM  0.00000000\n36        MU        BM  0.00000000\n37        MU        DT  0.00000000\n38        NT        BM  0.00000000\n39        NT        DT  0.00000000\n40        NT        MU  0.00000000\n41        NT        OR  0.00000000\n42        NV        BM  0.00000000\n43        NV        DT  0.00000000\n44        NV        MU  0.00000000\n45        NV        NT  0.00000000\n46        NV        OR  0.00000000\n47        OR        BM  0.00000000\n48        OR        DT  0.00000000\n49        OR        MU  0.00000000\n50        TP        BM  0.00000000\n51        TP        DT  0.00000000\n52        TP        MU  0.00000000\n53        TP        NT  0.00000000\n54        TP        NV  0.00000000\n55        TP        OR  0.00000000\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS           71.6 \n 2 SB        SB            3.57\n 3 BS        BS            1.68\n 4 AM        AM            1.21\n 5 BM        BM            0   \n 6 DT        DT            0   \n 7 MU        MU            0   \n 8 NT        NT            0   \n 9 NV        NV            0   \n10 OR        OR            0   \n11 TP        TP            0   \n\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_2019_11_norm_6.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA  PA_TRIPS\n1         AM        BS 786.05784\n2         YS        BS 774.85714\n3         SB        YS 669.16993\n4         YS        AM 425.14286\n5         SB        BS 320.30898\n6         YS        TP 286.28571\n7         YS        OR 252.00000\n8         SB        AM 246.06193\n9         SB        DT 157.71429\n10        YS        NV 155.14286\n11        YS        DT 126.00000\n12        YS        NT 108.00000\n13        SB        TP 107.82602\n14        SB        OR 103.71429\n15        AM        NV  87.42857\n16        YS        MU  81.42857\n17        AM        OR  72.85714\n18        SB        MU  71.14286\n19        AM        TP  70.28571\n20        SB        NT  55.71429\n21        SB        NV  49.52949\n22        YS        BM  39.42857\n23        SB        BM  35.14286\n24        AM        BM  31.71429\n25        AM        MU  25.71429\n26        AM        DT  18.00000\n27        AM        NT   6.00000\n28        BS        BM   0.00000\n29        BS        DT   0.00000\n30        BS        MU   0.00000\n31        BS        NT   0.00000\n32        BS        NV   0.00000\n33        BS        OR   0.00000\n34        BS        TP   0.00000\n35        DT        BM   0.00000\n36        MU        BM   0.00000\n37        MU        DT   0.00000\n38        NT        BM   0.00000\n39        NT        DT   0.00000\n40        NT        MU   0.00000\n41        NT        OR   0.00000\n42        NV        BM   0.00000\n43        NV        DT   0.00000\n44        NV        MU   0.00000\n45        NV        NT   0.00000\n46        NV        OR   0.00000\n47        OR        BM   0.00000\n48        OR        DT   0.00000\n49        OR        MU   0.00000\n50        TP        BM   0.00000\n51        TP        DT   0.00000\n52        TP        MU   0.00000\n53        TP        NT   0.00000\n54        TP        NV   0.00000\n55        TP        OR   0.00000\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 10 × 3\n# Groups:   ORIGIN_PA [10]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS           855. \n 2 SB        SB            87.2\n 3 AM        AM            47.5\n 4 BM        BM             0  \n 5 BS        BS             0  \n 6 DT        DT             0  \n 7 MU        MU             0  \n 8 NT        NT             0  \n 9 NV        NV             0  \n10 TP        TP             0  \n\n\n\n\n\ntmap_options(check.and.fix = TRUE)\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_norm_7.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows)  %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA    PA_TRIPS\n1         YS        AM 33.57826831\n2         SB        YS 31.09948302\n3         AM        BS 28.73420840\n4         YS        BS 11.18796992\n5         OR        DT 10.57549732\n6         SB        AM  9.85964912\n7         NV        DT  9.61231495\n8         NV        NT  9.10384571\n9         MU        DT  9.05398997\n10        BS        NV  8.55373148\n11        NT        OR  7.77622980\n12        SB        BS  7.39097744\n13        BS        TP  5.89719357\n14        NV        OR  5.80429713\n15        YS        OR  5.47619048\n16        DT        BM  5.15935139\n17        AM        TP  5.15288221\n18        TP        NV  4.82434563\n19        YS        NV  4.66917293\n20        AM        OR  4.57142857\n21        AM        NV  3.88471178\n22        NT        BM  3.73729941\n23        NV        MU  3.31962520\n24        YS        DT  2.71428571\n25        BS        OR  2.38187633\n26        YS        TP  2.26566416\n27        BS        DT  2.07088989\n28        AM        MU  2.00000000\n29        TP        OR  1.96015832\n30        NV        BM  1.76207235\n31        OR        BM  1.66452805\n32        OR        MU  1.54323233\n33        SB        DT  1.52380952\n34        TP        DT  1.47252747\n35        AM        DT  1.38095238\n36        YS        NT  1.33333333\n37        SB        TP  1.22055138\n38        NT        DT  1.12380952\n39        TP        NT  1.11875822\n40        MU        BM  0.88216961\n41        AM        NT  0.85714286\n42        BS        BM  0.82509158\n43        BS        NT  0.80000000\n44        BS        MU  0.78095238\n45        YS        MU  0.76190476\n46        SB        OR  0.61904762\n47        TP        MU  0.59047619\n48        SB        MU  0.57142857\n49        SB        NV  0.48120301\n50        TP        BM  0.44041154\n51        SB        BM  0.42857143\n52        NT        MU  0.37895761\n53        YS        BM  0.23809524\n54        AM        BM  0.19047619\n55        SB        NT  0.04761905\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS          40.9  \n 2 BM        BM          20.7  \n 3 SB        SB           8.32 \n 4 BS        BS           5.22 \n 5 DT        DT           2.40 \n 6 MU        MU           2.01 \n 7 TP        TP           1.66 \n 8 NV        NV           1.65 \n 9 OR        OR           1.33 \n10 AM        AM           1.24 \n11 NT        NT           0.279\n\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_2019_11_norm_7.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA    PA_TRIPS\n1         SB        YS 1152.887086\n2         AM        BS 1038.525384\n3         SB        AM  677.785714\n4         YS        BS  650.185714\n5         OR        DT  563.220938\n6         YS        AM  507.547932\n7         SB        BS  440.700000\n8         NV        NT  404.003044\n9         MU        DT  364.004955\n10        NT        OR  361.405683\n11        BS        TP  342.052438\n12        YS        OR  325.714286\n13        YS        DT  316.285714\n14        YS        NT  266.571429\n15        BS        NV  257.325969\n16        NV        DT  254.398887\n17        BS        OR  228.741528\n18        YS        NV  205.414286\n19        NV        OR  181.662087\n20        AM        TP  154.328571\n21        YS        TP  152.657143\n22        AM        OR  150.857143\n23        AM        NV  134.700000\n24        TP        NV  132.022889\n25        SB        OR  127.714286\n26        NT        BM  124.320421\n27        YS        MU  112.285714\n28        OR        BM  109.866094\n29        BS        DT   99.171429\n30        DT        BM   95.019621\n31        NV        BM   84.931770\n32        TP        OR   81.748731\n33        SB        DT   81.428571\n34        NV        MU   79.776464\n35        SB        NV   78.771429\n36        AM        DT   78.000000\n37        SB        NT   78.000000\n38        BS        NT   73.542857\n39        SB        TP   73.500000\n40        BS        BM   62.164286\n41        NT        DT   60.685714\n42        SB        MU   60.000000\n43        AM        MU   54.857143\n44        AM        NT   51.428571\n45        TP        NT   49.934987\n46        MU        BM   48.276190\n47        BS        MU   34.114286\n48        OR        MU   33.745409\n49        TP        DT   25.246753\n50        NT        MU   21.374716\n51        SB        BM   15.428571\n52        TP        MU   12.857143\n53        AM        BM   10.285714\n54        YS        BM   10.285714\n55        TP        BM    3.722586\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 10 × 3\n# Groups:   ORIGIN_PA [10]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS           779. \n 2 BM        BM           590. \n 3 BS        BS           387. \n 4 SB        SB           185. \n 5 TP        TP           147. \n 6 MU        MU           111. \n 7 DT        DT            84.8\n 8 NV        NV            75.9\n 9 NT        NT            27.2\n10 AM        AM            27.2\n\n\n\n\n\ntmap_options(check.and.fix = TRUE)\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_norm_8.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows)  %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA   PA_TRIPS\n1         YS        AM 54.2710323\n2         AM        BS 31.6403363\n3         MU        DT 30.5803798\n4         SB        YS 28.7579756\n5         NV        OR 18.0658537\n6         OR        DT 17.9298779\n7         NV        NT 17.8644522\n8         NV        DT 14.8688962\n9         NT        OR 13.1950568\n10        YS        BS 11.1175987\n11        BS        NV  9.1853777\n12        DT        BM  8.2857811\n13        SB        AM  8.0134077\n14        BS        OR  6.8846852\n15        TP        NV  6.3871104\n16        BS        TP  6.0623215\n17        NV        MU  5.7794747\n18        SB        BS  5.2853683\n19        NT        BM  5.1880693\n20        OR        BM  4.8051573\n21        YS        OR  3.9523810\n22        NV        BM  3.7346189\n23        YS        NV  3.6384672\n24        OR        MU  3.2319503\n25        AM        NV  2.8946412\n26        AM        DT  2.8571429\n27        BS        DT  2.7208639\n28        TP        OR  2.5683165\n29        YS        TP  2.5591454\n30        MU        BM  2.2396705\n31        SB        OR  2.0000000\n32        AM        OR  1.8571429\n33        NT        DT  1.7244444\n34        TP        NT  1.7220120\n35        SB        NV  1.6173608\n36        TP        DT  1.5734196\n37        YS        NT  1.5714286\n38        BS        BM  1.4939711\n39        BS        MU  1.2793651\n40        AM        MU  1.2380952\n41        SB        DT  1.1428571\n42        YS        DT  1.1428571\n43        NT        MU  0.9330574\n44        SB        BM  0.9047619\n45        SB        MU  0.8571429\n46        YS        MU  0.8571429\n47        BS        NT  0.7932275\n48        TP        BM  0.7242923\n49        SB        NT  0.7142857\n50        AM        TP  0.6502746\n51        TP        MU  0.6158730\n52        AM        BM  0.5238095\n53        AM        NT  0.5238095\n54        YS        BM  0.5238095\n55        SB        TP  0.3106700\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS          42.4  \n 2 BM        BM          23.3  \n 3 SB        SB          15.9  \n 4 BS        BS           8.02 \n 5 DT        DT           6.40 \n 6 MU        MU           6.15 \n 7 NV        NV           4.37 \n 8 OR        OR           3.33 \n 9 TP        TP           1.72 \n10 AM        AM           0.927\n11 NT        NT           0.388\n\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_2022_08_norm_8.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA    PA_TRIPS\n1         YS        AM 34.07596623\n2         SB        YS 30.11558226\n3         MU        DT 17.50312366\n4         AM        BS 13.74581896\n5         NV        NT 13.31479073\n6         NT        OR 10.42373226\n7         YS        BS  9.81361332\n8         NV        OR  9.26508277\n9         BS        OR  8.89583921\n10        BS        NV  8.82433153\n11        NV        DT  8.64074929\n12        SB        AM  8.07348055\n13        OR        DT  7.92913657\n14        DT        BM  6.91241364\n15        BS        TP  6.71294019\n16        TP        NV  4.97525238\n17        SB        BS  4.85434345\n18        AM        OR  3.95454545\n19        NT        BM  3.92788997\n20        NV        MU  3.40236268\n21        TP        OR  3.30260869\n22        YS        OR  3.22727273\n23        AM        NV  2.63637230\n24        OR        BM  2.47676305\n25        YS        NV  2.31003753\n26        YS        TP  2.16785282\n27        NV        BM  2.11790061\n28        BS        NT  2.01718518\n29        BS        DT  1.97900894\n30        MU        BM  1.96673914\n31        AM        DT  1.54545455\n32        BS        MU  1.45079869\n33        SB        NV  1.32401155\n34        TP        NT  1.29948458\n35        OR        MU  1.25179954\n36        SB        TP  1.14569120\n37        AM        TP  1.04896104\n38        SB        OR  1.04545455\n39        NT        DT  0.99672158\n40        AM        NT  0.90909091\n41        SB        BM  0.86363636\n42        YS        BM  0.72727273\n43        YS        DT  0.72727273\n44        BS        BM  0.64610641\n45        TP        DT  0.64566814\n46        AM        MU  0.54545455\n47        SB        MU  0.50000000\n48        YS        MU  0.45454545\n49        NT        MU  0.42109735\n50        SB        DT  0.40909091\n51        YS        NT  0.22727273\n52        TP        BM  0.19808992\n53        SB        NT  0.13636364\n54        AM        BM  0.04545455\n55        TP        MU  0.04529843\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 10 × 3\n# Groups:   ORIGIN_PA [10]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 BM        BM          28.8  \n 2 YS        YS          23.6  \n 3 SB        SB          15.9  \n 4 BS        BS           5.05 \n 5 MU        MU           4.37 \n 6 NV        NV           3.10 \n 7 DT        DT           2.53 \n 8 TP        TP           1.18 \n 9 AM        AM           0.483\n10 NT        NT           0.443\n\n\n\n\n\ntmap_options(check.and.fix = TRUE)\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_norm_9.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows)  %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA   PA_TRIPS\n1         SB        YS 29.6985009\n2         AM        BS 23.2781101\n3         MU        DT 20.8638621\n4         NT        OR 17.4732003\n5         NV        OR 16.7090113\n6         YS        AM 16.5693830\n7         OR        DT 14.6183124\n8         NV        NT 11.0546522\n9         YS        BS 10.2073733\n10        NV        DT  8.4729652\n11        DT        BM  6.8964398\n12        BS        OR  6.1384924\n13        BS        NV  6.1138363\n14        NV        MU  5.2645030\n15        SB        BS  4.7250384\n16        SB        AM  4.5161290\n17        AM        OR  4.2380952\n18        OR        BM  3.9632109\n19        NT        BM  3.8766230\n20        BS        TP  3.8475366\n21        OR        MU  3.8422232\n22        TP        NV  3.7558750\n23        TP        OR  3.3536203\n24        YS        OR  2.9047619\n25        NT        DT  2.5868132\n26        YS        NV  2.5145929\n27        SB        OR  2.3333333\n28        NV        BM  2.1551827\n29        MU        BM  2.1413903\n30        AM        NV  1.8156682\n31        YS        DT  1.5714286\n32        YS        TP  1.4976959\n33        BS        DT  1.3751257\n34        TP        DT  1.3334577\n35        BS        MU  1.2505495\n36        SB        BM  1.1428571\n37        SB        MU  1.0952381\n38        BS        NT  1.0373626\n39        AM        TP  1.0368664\n40        NT        MU  1.0043301\n41        AM        MU  0.9047619\n42        SB        TP  0.8663594\n43        TP        NT  0.8003565\n44        SB        NV  0.7987711\n45        YS        BM  0.6190476\n46        YS        MU  0.5714286\n47        YS        NT  0.5238095\n48        BS        BM  0.4877718\n49        SB        NT  0.4761905\n50        SB        DT  0.4285714\n51        TP        BM  0.3986178\n52        TP        MU  0.3384615\n53        AM        DT  0.3333333\n54        AM        BM  0.2857143\n55        AM        NT  0.1904762\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS          24.6  \n 2 BM        BM          22.2  \n 3 SB        SB          10.0  \n 4 BS        BS           6.82 \n 5 DT        DT           5.52 \n 6 MU        MU           4.68 \n 7 OR        OR           3.73 \n 8 NV        NV           2.62 \n 9 AM        AM           0.972\n10 TP        TP           0.940\n11 NT        NT           0.177\n\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_2022_08_norm_9.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA    PA_TRIPS\n1         SB        YS 23.52388899\n2         NT        OR 13.11159840\n3         YS        AM 12.39929348\n4         AM        BS 11.78810901\n5         NV        OR 10.87292276\n6         YS        BS  9.78056426\n7         MU        DT  9.75765634\n8         BS        OR  8.58422589\n9         NV        NT  7.58918104\n10        OR        DT  7.03574694\n11        DT        BM  4.92796058\n12        BS        NV  4.82779222\n13        YS        OR  4.13636364\n14        SB        BS  3.89341693\n15        NV        DT  3.65195039\n16        TP        NV  3.55175622\n17        TP        OR  3.01961239\n18        BS        TP  2.80914925\n19        AM        OR  2.77272727\n20        YS        NV  2.60188088\n21        NV        MU  2.44651958\n22        OR        BM  2.42647067\n23        SB        OR  2.18181818\n24        BS        MU  1.89445300\n25        NV        BM  1.78671034\n26        AM        NV  1.62225705\n27        NT        DT  1.43297381\n28        OR        MU  1.36214865\n29        NT        BM  1.35217723\n30        YS        TP  1.34012539\n31        MU        BM  1.33266058\n32        BS        NT  1.32819723\n33        YS        DT  1.27272727\n34        BS        DT  1.26668396\n35        SB        NV  1.21159875\n36        TP        NT  1.12547902\n37        SB        AM  1.03291536\n38        YS        BM  0.81818182\n39        SB        BM  0.81818182\n40        AM        DT  0.72727273\n41        YS        MU  0.68181818\n42        TP        DT  0.58636946\n43        TP        MU  0.54930663\n44        AM        TP  0.51724138\n45        SB        MU  0.50000000\n46        AM        MU  0.45454545\n47        AM        NT  0.45454545\n48        NT        MU  0.44581990\n49        SB        TP  0.37304075\n50        SB        DT  0.27272727\n51        YS        NT  0.27272727\n52        BS        BM  0.22477889\n53        AM        BM  0.13636364\n54        TP        BM  0.12397456\n55        SB        NT  0.04545455\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 BM        BM          18.6  \n 2 YS        YS          16.4  \n 3 SB        SB           7.07 \n 4 BS        BS           3.66 \n 5 MU        MU           2.52 \n 6 DT        DT           2.13 \n 7 OR        OR           2.07 \n 8 NV        NV           1.82 \n 9 AM        AM           0.765\n10 TP        TP           0.503\n11 NT        NT           0.201\n\n\n\n\n\ntmap_options(check.and.fix = TRUE)\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_norm_10.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows)  %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA   PA_TRIPS\n1         SB        YS 20.2682115\n2         NT        OR 18.9209250\n3         AM        BS 16.9221564\n4         NV        OR 16.4087523\n5         OR        DT 10.4447649\n6         YS        BS  9.4700461\n7         MU        DT  9.2002212\n8         BS        OR  8.2630268\n9         YS        AM  7.7442742\n10        DT        BM  6.6517715\n11        NV        NT  5.1921341\n12        BS        NV  5.1404578\n13        NV        DT  5.0336147\n14        TP        OR  5.0263685\n15        YS        OR  3.8095238\n16        NV        MU  3.8009183\n17        OR        MU  3.6188937\n18        OR        BM  2.9955352\n19        AM        OR  2.8571429\n20        YS        NV  2.8371736\n21        SB        BS  2.8033794\n22        TP        NV  2.7694628\n23        BS        TP  2.5509805\n24        AM        NV  1.9508449\n25        BS        MU  1.9289377\n26        SB        NV  1.8986175\n27        SB        OR  1.7142857\n28        AM        MU  1.5238095\n29        NV        BM  1.4459670\n30        MU        BM  1.4406464\n31        SB        AM  1.4270353\n32        YS        TP  1.3133641\n33        NT        BM  1.2401678\n34        BS        DT  1.2117380\n35        NT        DT  1.1589744\n36        SB        BM  1.1428571\n37        NT        MU  1.0716663\n38        AM        DT  0.9523810\n39        AM        TP  0.9216590\n40        SB        DT  0.9047619\n41        YS        MU  0.9047619\n42        TP        NT  0.8879778\n43        TP        MU  0.8461538\n44        SB        MU  0.8095238\n45        BS        NT  0.7010989\n46        YS        BM  0.6666667\n47        YS        DT  0.6666667\n48        TP        DT  0.5337539\n49        BS        BM  0.4167211\n50        SB        TP  0.3010753\n51        AM        NT  0.2857143\n52        YS        NT  0.2857143\n53        TP        BM  0.2237055\n54        SB        NT  0.1904762\n55        AM        BM  0.0952381\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS         22.7   \n 2 BM        BM         18.9   \n 3 SB        SB          6.42  \n 4 BS        BS          4.84  \n 5 OR        OR          2.61  \n 6 NV        NV          2.48  \n 7 DT        DT          2.48  \n 8 MU        MU          2.29  \n 9 AM        AM          0.721 \n10 TP        TP          0.372 \n11 NT        NT          0.0744\n\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_2022_08_norm_10.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA    PA_TRIPS\n1         SB        YS 23.70643555\n2         NT        OR 14.98442916\n3         NV        OR 11.10588830\n4         AM        BS 10.01186494\n5         BS        OR  9.52055775\n6         YS        BS  7.35893417\n7         MU        DT  6.41002806\n8         DT        BM  6.02473026\n9         YS        AM  5.66385857\n10        OR        DT  5.47792942\n11        BS        NV  4.76305766\n12        YS        OR  4.45454545\n13        SB        BS  4.41849530\n14        NV        NT  4.34459988\n15        AM        OR  3.68181818\n16        TP        OR  3.17858732\n17        YS        NV  3.05172414\n18        OR        MU  2.41135024\n19        NV        MU  2.39306248\n20        TP        NV  2.35968691\n21        BS        MU  2.33590139\n22        BS        TP  2.04174059\n23        NV        DT  1.70338534\n24        SB        OR  1.54545455\n25        OR        BM  1.54499142\n26        BS        DT  1.41859994\n27        YS        TP  1.36363636\n28        MU        BM  1.23805997\n29        YS        MU  1.22727273\n30        AM        NV  1.22100313\n31        SB        NV  1.05015674\n32        AM        MU  1.04545455\n33        SB        AM  1.01880878\n34        NT        BM  0.97191472\n35        YS        DT  0.81818182\n36        NV        BM  0.80058152\n37        BS        NT  0.71417565\n38        YS        BM  0.68181818\n39        TP        DT  0.63788051\n40        AM        DT  0.63636364\n41        YS        NT  0.63636364\n42        AM        TP  0.61128527\n43        NT        MU  0.57601644\n44        SB        BM  0.54545455\n45        BS        BM  0.50150790\n46        AM        NT  0.50000000\n47        TP        NT  0.46359864\n48        SB        DT  0.45454545\n49        TP        MU  0.40600924\n50        SB        TP  0.37147335\n51        SB        MU  0.36363636\n52        NT        DT  0.35593220\n53        AM        BM  0.31818182\n54        TP        BM  0.05122898\n55        SB        NT  0.04545455\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 BM        BM          17.0  \n 2 YS        YS          14.4  \n 3 SB        SB           7.38 \n 4 BS        BS           3.62 \n 5 OR        OR           1.88 \n 6 MU        MU           1.59 \n 7 NV        NV           1.25 \n 8 DT        DT           1.09 \n 9 AM        AM           0.472\n10 TP        TP           0.275\n11 NT        NT           0.110\n\n\n\n\n\ntmap_options(check.and.fix = TRUE)\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_norm_11.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows)  %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA   PA_TRIPS\n1         NT        OR 24.1619132\n2         SB        YS 20.4134534\n3         NV        OR 19.7632224\n4         AM        BS 18.8457835\n5         DT        BM 12.4242619\n6         OR        DT 10.9622361\n7         MU        DT 10.5904685\n8         BS        NV  8.9696601\n9         YS        BS  6.6820276\n10        BS        OR  6.2397735\n11        NV        NT  5.8671799\n12        TP        NV  5.6286715\n13        TP        OR  5.5041468\n14        YS        AM  4.7127183\n15        OR        MU  4.7117221\n16        NV        DT  4.0652153\n17        NV        MU  3.8329804\n18        SB        BS  3.5437788\n19        OR        BM  3.4402721\n20        YS        OR  3.4285714\n21        AM        OR  3.0476190\n22        YS        NV  2.4992320\n23        BS        TP  2.4221243\n24        MU        BM  2.0793847\n25        NT        MU  1.8674825\n26        BS        MU  1.8578755\n27        NT        DT  1.7648352\n28        AM        NV  1.7250384\n29        AM        MU  1.5238095\n30        NV        BM  1.3429465\n31        SB        OR  1.3333333\n32        YS        MU  1.2380952\n33        SB        AM  1.2104455\n34        TP        MU  1.1604396\n35        YS        TP  1.1059908\n36        BS        DT  1.0568081\n37        SB        BM  0.9523810\n38        TP        NT  0.9061419\n39        YS        BM  0.9047619\n40        NT        BM  0.7850717\n41        SB        NV  0.7803379\n42        SB        DT  0.7619048\n43        AM        DT  0.6666667\n44        SB        NT  0.6666667\n45        SB        MU  0.5714286\n46        TP        DT  0.5128683\n47        BS        BM  0.4910514\n48        SB        TP  0.4685100\n49        YS        DT  0.4285714\n50        AM        TP  0.4147465\n51        AM        NT  0.3809524\n52        BS        NT  0.3142857\n53        AM        BM  0.2857143\n54        YS        NT  0.2857143\n55        TP        BM  0.1264972\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS          24.1  \n 2 BM        BM          18.5  \n 3 SB        SB           8.08 \n 4 BS        BS           5.45 \n 5 NV        NV           3.82 \n 6 OR        OR           3.66 \n 7 DT        DT           2.41 \n 8 AM        AM           2.12 \n 9 MU        MU           1.81 \n10 TP        TP           0.479\n11 NT        NT           0.172\n\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_2022_08_norm_11.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA   PA_TRIPS\n1         SB        YS 17.9809515\n2         NT        OR 14.9389157\n3         NV        OR 14.1748976\n4         AM        BS 10.9059058\n5         BS        NV  7.6524662\n6         DT        BM  7.6284027\n7         BS        OR  6.5732211\n8         MU        DT  6.5110928\n9         OR        DT  6.3631264\n10        YS        BS  5.3840125\n11        TP        OR  4.6741084\n12        NV        NT  4.5787345\n13        YS        AM  4.2788372\n14        TP        NV  3.9576175\n15        YS        OR  3.3636364\n16        OR        MU  3.2098482\n17        SB        BS  3.1661442\n18        YS        NV  2.9357367\n19        NV        MU  2.3715720\n20        BS        TP  2.3348854\n21        AM        NV  2.2664577\n22        AM        OR  2.0909091\n23        OR        BM  2.0229314\n24        BS        MU  1.5770416\n25        NT        MU  1.5444142\n26        MU        BM  1.4118396\n27        YS        MU  1.4090909\n28        YS        TP  1.2931034\n29        AM        MU  1.0909091\n30        NV        BM  1.0889000\n31        NV        DT  0.9871697\n32        BS        NT  0.9653313\n33        SB        OR  0.9545455\n34        TP        MU  0.9075501\n35        NT        BM  0.8942427\n36        SB        AM  0.8652038\n37        TP        BM  0.8344283\n38        BS        DT  0.7770966\n39        SB        BM  0.7727273\n40        NT        DT  0.7642527\n41        YS        BM  0.7272727\n42        AM        TP  0.7053292\n43        TP        NT  0.6699143\n44        SB        TP  0.6003135\n45        SB        NV  0.5031348\n46        AM        DT  0.4545455\n47        YS        NT  0.4545455\n48        YS        DT  0.4090909\n49        SB        NT  0.3636364\n50        BS        BM  0.3197187\n51        SB        DT  0.3181818\n52        AM        BM  0.2272727\n53        AM        NT  0.2272727\n54        SB        MU  0.1363636\n55        TP        DT  0.1202809\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 BM        BM          19.6  \n 2 YS        YS          15.4  \n 3 SB        SB           6.67 \n 4 BS        BS           3.89 \n 5 NV        NV           2.70 \n 6 OR        OR           2.17 \n 7 MU        MU           1.47 \n 8 AM        AM           1.22 \n 9 DT        DT           1.13 \n10 TP        TP           0.397\n11 NT        NT           0.122\n\n\n\n\n\ntmap_options(check.and.fix = TRUE)\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_norm_12.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows)  %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA   PA_TRIPS\n1         NT        OR 49.0513244\n2         NV        OR 18.3313521\n3         AM        BS 17.2722498\n4         SB        YS 15.5486300\n5         DT        BM 15.4027930\n6         OR        DT 13.0154106\n7         MU        DT 12.4042916\n8         YS        BS  8.7557604\n9         OR        MU  7.3955708\n10        TP        OR  6.4223488\n11        TP        NV  5.8910876\n12        NV        NT  5.5764864\n13        YS        AM  5.4940650\n14        BS        OR  4.9056443\n15        BS        NV  4.7520016\n16        NV        MU  4.7330169\n17        OR        BM  4.7135065\n18        MU        BM  3.5292438\n19        YS        OR  3.3809524\n20        BS        TP  2.7608115\n21        SB        BS  2.7050691\n22        YS        NV  2.5637481\n23        NT        MU  2.3324593\n24        NV        DT  2.2926797\n25        AM        OR  2.2380952\n26        SB        OR  1.7142857\n27        NV        BM  1.7006605\n28        AM        NV  1.6513057\n29        SB        AM  1.6175115\n30        AM        MU  1.5714286\n31        YS        TP  1.4976959\n32        YS        MU  1.4285714\n33        BS        DT  1.2579096\n34        BS        MU  1.2080586\n35        YS        BM  1.1428571\n36        TP        MU  1.1362637\n37        SB        BM  1.0476190\n38        AM        DT  0.9047619\n39        NT        BM  0.8713220\n40        SB        TP  0.8586790\n41        BS        BM  0.7283908\n42        NT        DT  0.7245421\n43        AM        TP  0.6682028\n44        YS        DT  0.6666667\n45        TP        NT  0.6613133\n46        BS        NT  0.6490842\n47        SB        MU  0.6190476\n48        TP        BM  0.5884148\n49        SB        NV  0.4685100\n50        AM        NT  0.4285714\n51        SB        NT  0.4285714\n52        SB        DT  0.3333333\n53        YS        NT  0.3333333\n54        TP        DT  0.2930676\n55        AM        BM  0.2380952\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 YS        YS         31.4   \n 2 BM        BM         21.5   \n 3 SB        SB          9.01  \n 4 BS        BS          5.92  \n 5 DT        DT          5.43  \n 6 OR        OR          4.80  \n 7 AM        AM          3.26  \n 8 NV        NV          2.83  \n 9 MU        MU          2.69  \n10 TP        TP          0.655 \n11 NT        NT          0.0916\n\ntemp_sf <- readRDS(\"D:/167_OD_Analysis/sf_2022_08_norm_12.rds\")\ntemp_sf_pa <- gen_od_timing_PA(temp_sf)\ntemp_sf_pa_intra <- gen_od_timing_PA_intra(temp_sf_pa)\ntemp_sf_pa_inter <- gen_od_timing_PA_inter(temp_sf_pa)\ntemp_sf_pa_intra_flows <- gen_od_timing_PA_flows(temp_sf_pa_intra)\n\ntmap_plot_pa(sf_BS_167_DIR_1_MPSZ, temp_sf_pa_intra_flows)\n\n\n\n\n\nst_drop_geometry(temp_sf_pa_intra_flows) %>% arrange(desc(PA_TRIPS))\n\n   ORIGIN_PA DESTIN_PA    PA_TRIPS\n1         NT        OR 24.85549247\n2         SB        YS 13.90229578\n3         NV        OR 13.28310736\n4         AM        BS 10.91327757\n5         DT        BM  8.90601900\n6         YS        BS  7.19435737\n7         OR        DT  7.01158812\n8         MU        DT  6.24309310\n9         BS        OR  5.93354205\n10        OR        MU  4.68234172\n11        NV        NT  4.48868463\n12        BS        NV  3.94236101\n13        YS        AM  3.59061125\n14        TP        OR  3.51598654\n15        TP        NV  3.24403400\n16        NV        MU  3.16478835\n17        OR        BM  3.14465229\n18        MU        BM  2.83015368\n19        AM        OR  2.77272727\n20        YS        OR  2.72727273\n21        BS        TP  2.52009477\n22        YS        BM  2.13636364\n23        YS        NV  2.09717868\n24        SB        BM  2.09090909\n25        SB        BS  1.93103448\n26        SB        AM  1.66457680\n27        YS        MU  1.45454545\n28        BS        MU  1.35901387\n29        SB        TP  1.32131661\n30        YS        TP  1.31661442\n31        NV        DT  1.27386426\n32        SB        OR  1.27272727\n33        AM        NV  1.21473354\n34        NV        BM  1.19540213\n35        NT        MU  1.17444833\n36        SB        NV  1.09874608\n37        AM        MU  1.04545455\n38        TP        MU  0.93143297\n39        BS        NT  0.83590139\n40        YS        NT  0.72727273\n41        BS        DT  0.67925375\n42        TP        NT  0.67192273\n43        NT        BM  0.63557886\n44        AM        DT  0.59090909\n45        SB        MU  0.59090909\n46        TP        BM  0.49677156\n47        NT        DT  0.49460709\n48        AM        NT  0.45454545\n49        BS        BM  0.34042337\n50        AM        TP  0.28213166\n51        SB        DT  0.27272727\n52        TP        DT  0.24056183\n53        YS        DT  0.18181818\n54        AM        BM  0.09090909\n55        SB        NT  0.09090909\n\nplot_trip_summary(temp_sf)\n\n\n\n\ntemp_sf_pa_inter %>% arrange(desc(PA_TRIPS))\n\n# A tibble: 11 × 3\n# Groups:   ORIGIN_PA [11]\n   ORIGIN_PA DESTIN_PA PA_TRIPS\n   <chr>     <chr>        <dbl>\n 1 BM        BM         18.2   \n 2 YS        YS         17.8   \n 3 SB        SB          9.77  \n 4 BS        BS          4.13  \n 5 DT        DT          3.27  \n 6 OR        OR          2.79  \n 7 AM        AM          2.24  \n 8 NV        NV          2.16  \n 9 MU        MU          1.59  \n10 TP        TP          0.405 \n11 NT        NT          0.0976\n\n\n\n\n\n\n\n\n\ngen_od_timing2 <- function(input_OD, sf_bs){\n  sf <- od_to_sf(input_OD, sf_bs)\n  \n  return (sf)\n}\ntmap_plot_route <- function(BS, OD) {\n  tmap_mode(\"view\")\n  tm_shape(BS) +\n    tm_dots(col = \"magenta\", scale = 2) +\n  #tm_shape(sf_BS_167_DIR_2) +\n  #  tm_dots(col = \"blue\", scale = 2) +\n  tm_shape(OD) + \n    tm_lines(col = \"TOTAL_TRIPS\", style=\"fixed\", breaks = c(0, 1, 5, 10, 15, 25, 40, 60, 80, 100), lwd = \"TOTAL_TRIPS\", scale=15, palette=\"viridis\") \n} \n\nplot_trip_summary <- function(OD){ \n  summary(OD$TOTAL_TRIPS) \n  p <- ggplot(OD, aes(x=TOTAL_TRIPS)) + geom_histogram(binwidth=25) + xlim(0, 500) + ylim(0, 50)\n  ggplotly(p) \n}\n\n\nod_norm <- readRDS(\"D:/167_OD_Analysis/sf_norm_8.rds\")\ntemp_bs_data <- BS_167_DIR_1_DF %>% arrange(BS_167_DIR_1_DF$Seq)\n\nbs_flow_norm <- data.frame(ORIGIN_BS = integer(), DESTIN_BS = integer(), TOTAL_TRIPS = double())\n\ncurrent_bs <- temp_bs_data[1,]$BS_Code\ncurrent_flow <- 0\n\nfor (i in 2:nrow(temp_bs_data)){\n  next_bs <- temp_bs_data[i,]$BS_Code\n  \n  # Boarding Pax\n  temp_flow <- sum((od_norm %>% filter(ORIGIN_BS == current_bs))$NORM_TRIPS)\n  \n  if (is.na(temp_flow) == FALSE){\n    current_flow <- current_flow + temp_flow\n  }\n  \n  # Alighting Pax\n  temp_flow <- sum((od_norm %>% filter(DESTIN_BS == current_bs))$NORM_TRIPS)\n  \n  if (is.na(temp_flow) == FALSE){\n    current_flow <- current_flow - temp_flow\n  }\n  \n  bs_flow_norm_temp <- data.frame(ORIGIN_BS = current_bs, DESTIN_BS = next_bs, TOTAL_TRIPS = current_flow)\n  bs_flow_norm[nrow(bs_flow_norm) +1,] <- bs_flow_norm_temp  \n  current_bs <- next_bs\n}\nbs_flow_norm\n\n   ORIGIN_BS DESTIN_BS TOTAL_TRIPS\n1      58009     58151    9.500948\n2      58151     58331    9.863217\n3      58331     58039   36.287934\n4      58039     58029   47.335553\n5      58029     58019   54.096452\n6      58019     57139   55.691207\n7      57139     57129   49.603830\n8      57129     57119   66.936578\n9      57119     57089   75.835138\n10     57089     57079   81.108014\n11     57079     57069   83.762319\n12     57069     57059   83.565107\n13     57059     57049   81.144957\n14     57049     57039   80.247547\n15     57039     57029   84.617757\n16     57029     57019   93.170721\n17     57019     56099   92.768264\n18     56099     56089  100.479717\n19     56089     56079  100.461802\n20     56079     56069  100.421754\n21     56069     56059   96.196801\n22     56059     56049   51.764144\n23     56049     56039   63.578077\n24     56039     56029   69.254491\n25     56029     56019   74.806136\n26     56019     53099   80.380529\n27     53099     53089   79.850883\n28     53089     53079   83.258058\n29     53079     53069   85.616415\n30     53069     53059   87.793696\n31     53059     53049   61.077342\n32     53049     53039   63.058500\n33     53039     53029   64.910006\n34     53029     53019   61.320146\n35     53019     51069   60.757038\n36     51069     51059   61.675243\n37     51059     51049   62.499156\n38     51049     51039   60.222727\n39     51039     51029   60.917687\n40     51029     51019   61.760596\n41     51019     50059   64.765650\n42     50059     50049   69.742622\n43     50049     50037   73.772003\n44     50037     50069   65.784210\n45     50069     40129   80.066044\n46     40129     40189  101.355989\n47     40189     40179   98.880239\n48     40179      9219   99.207401\n49      9219      9047   86.267413\n50      9047      9037   78.329942\n51      9037      8138   76.964359\n52      8138      8057   76.650951\n53      8057      8069   94.106168\n54      8069      4179   95.598935\n55      4179      2049   94.678899\n56      2049      2029   93.023967\n57      2029      3019   91.790829\n58      3019      3059   76.124086\n59      3059      3129   56.511681\n60      3129      3218   34.566237\n61      3218      5631   28.423941\n62      5631      5521   25.343490\n63      5521     10021   27.606474\n64     10021     10041   28.827638\n65     10041     10051   31.053511\n66     10051     10061   29.731031\n67     10061     10071   30.540106\n68     10071     10501   28.196094\n69     10501     10081   28.251659\n70     10081     10009   10.246177\n\n\n\ntmap_plot_route(sf_BS_167_DIR_1, gen_od_timing2(bs_flow_norm, sf_BS_167_DIR_1))\n\n\n\n\n\n\n\nod_norm <- readRDS(\"D:/167_OD_Analysis/sf_2022_08_norm_8.rds\")\ntemp_bs_data <- BS_167_DIR_1_DF %>% arrange(BS_167_DIR_1_DF$Seq)\n\nbs_flow_norm <- data.frame(ORIGIN_BS = integer(), DESTIN_BS = integer(), TOTAL_TRIPS = double())\n\ncurrent_bs <- temp_bs_data[1,]$BS_Code\ncurrent_flow <- 0\n\nfor (i in 2:nrow(temp_bs_data)){\n  next_bs <- temp_bs_data[i,]$BS_Code\n  \n  # Boarding Pax\n  temp_flow <- sum((od_norm %>% filter(ORIGIN_BS == current_bs))$NORM_TRIPS)\n  \n  if (is.na(temp_flow) == FALSE){\n    current_flow <- current_flow + temp_flow\n  }\n  \n  # Alighting Pax\n  temp_flow <- sum((od_norm %>% filter(DESTIN_BS == current_bs))$NORM_TRIPS)\n  \n  if (is.na(temp_flow) == FALSE){\n    current_flow <- current_flow - temp_flow\n  }\n  \n  bs_flow_norm_temp <- data.frame(ORIGIN_BS = current_bs, DESTIN_BS = next_bs, TOTAL_TRIPS = current_flow)\n  bs_flow_norm[nrow(bs_flow_norm) +1,] <- bs_flow_norm_temp  \n  current_bs <- next_bs\n}\nbs_flow_norm\n\n   ORIGIN_BS DESTIN_BS TOTAL_TRIPS\n1      58009     58151    0.000000\n2      58151     58331    0.370632\n3      58331     58039   35.961541\n4      58039     58029   42.552450\n5      58029     58019   45.928612\n6      58019     57139   42.358280\n7      57139     57129   37.010858\n8      57129     57119   34.355141\n9      57119     57089   54.246291\n10     57089     57079   55.280606\n11     57079     57069   54.813015\n12     57069     57059   54.451175\n13     57059     57049   51.013129\n14     57049     57039   50.948759\n15     57039     57029   52.467239\n16     57029     57019   57.732522\n17     57019     56099   56.864001\n18     56099     56089   67.874545\n19     56089     56079   67.874545\n20     56079     56069   67.792461\n21     56069     56059   65.587640\n22     56059     56049   34.463993\n23     56049     56039   42.368519\n24     56039     56029   45.578747\n25     56029     56019   48.466882\n26     56019     53099   50.156250\n27     53099     53089   49.959232\n28     53089     53079   52.261437\n29     53079     53069   54.454077\n30     53069     53059   57.443489\n31     53059     53049   52.503237\n32     53049     53039   53.763319\n33     53039     53029   56.945371\n34     53029     53019   52.720287\n35     53019     51069   52.268685\n36     51069     51059   51.937465\n37     51059     51049   52.708777\n38     51049     51039   50.896768\n39     51039     51029   50.093635\n40     51029     51019   48.672663\n41     51019     50059   51.659642\n42     50059     50049   50.952868\n43     50049     50037   52.173153\n44     50037     50069   45.582504\n45     50069     40129   54.578685\n46     40129     40189   68.330523\n47     40189     40179   66.643827\n48     40179      9219   66.195776\n49      9219      9047   44.025566\n50      9047      9037   44.025566\n51      9037      8138   44.025566\n52      8138      8057   44.025566\n53      8057      8069   60.185733\n54      8069      4179   59.479678\n55      4179      2049   58.473773\n56      2049      2029   56.116295\n57      2029      3019   54.879382\n58      3019      3059   46.204501\n59      3059      3129   46.204501\n60      3129      3218   46.204501\n61      3218      5631   47.931546\n62      5631      5521   46.912613\n63      5521     10021   49.768524\n64     10021     10041   52.683549\n65     10041     10051   55.228638\n66     10051     10061   56.311844\n67     10061     10071   55.932815\n68     10071     10501   54.659104\n69     10501     10081   54.289465\n70     10081     10009   40.333258\n\n\n\ntmap_plot_route(sf_BS_167_DIR_1, gen_od_timing2(bs_flow_norm, sf_BS_167_DIR_1))\n\n\n\n\n\n\nTodo list:\n\nVisualisation tmap for Subzone / bus stop see how to display data\nEDA on trip - derivation on initial analysis (eg. focus on AM Peak Dir 1?)\n\nSequential trial and error, might be worthwhile to check off peak trends as well - without data cannot determine which user group but maybe can guess?\n\nK-means clustering on types of stops based on temporal data - each stop, pattern based on day type [probably seperate article]"
  },
  {
    "objectID": "explore/data/167_OD_analysis/MPSZ-2019.html",
    "href": "explore/data/167_OD_analysis/MPSZ-2019.html",
    "title": "UrbanCoalesce",
    "section": "",
    "text": "<!DOCTYPE qgis PUBLIC ‘http://mrcc.com/qgis.dtd’ ‘SYSTEM’>     dataset\n\n\n        0 0     false"
  },
  {
    "objectID": "explore/index.html",
    "href": "explore/index.html",
    "title": "UrbanCoalesce // Explore",
    "section": "",
    "text": "Order By\n       Default\n         \n          Title\n        \n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1 min\n\n\n\n\n\n\n\n\n\n\n\n\nPreprocessing of OSM Building Data (HDB)\n\n\n\n\n\nPreprocesses OSM Building Data with HDB Property Information\n\n\n\n\n\nAug 4, 2024\n\n\nTeo Ren Jie\n\n\n6 min\n\n\n\n\n\n\n\n\n\n\n\n\nEffects of Thomson East Coast Line on Bus Service 167\n\n\n\n\n\nAnalysis of Travel Patterns Using OD-Matrix provided by LTA\n\n\n\n\n\nDec 23, 2023\n\n\nTeo Ren Jie\n\n\n29 min\n\n\n\n\n\n\n\n\n\n\n\n\nSample Python Document\n\n\n\n\n\nThis is a document to test python\n\n\n\n\n\nNov 26, 2023\n\n\nTeo Ren Jie\n\n\n1 min\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "explore/sample_doc.html",
    "href": "explore/sample_doc.html",
    "title": "Sample Python Document",
    "section": "",
    "text": "reticulate::repl_python()\n\nexit\n\n\n\na = 1 + 3\n\n\n\n\n\nprint(a)\n\n4"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Teo Ren Jie",
    "section": "",
    "text": "About Me\n\n\nI am Ren Jie, a Year 3 Information Systems undergraduate at the Singapore Management University, majoring in Digitalisation & Cloud Solutions and Urban Science. I also hold a Diploma in Architecture from Singapore Polytechnic, having a good understanding of the planning, design, policy and regulatory aspects of the built environment.\nMy main interest is in urban science research, focusing in areas of sustainability and transport flows. I have summarised it in three key pointers:\n\nUnderstanding data generated by urban cities\nAnalysing and drawing conclusions from data\nComing up with actionable solutions against urban issues\n\nI believe that these skills will allow gaps in the current urban planning and design ecosystem be filled, closing the loop between the planner and the data scientist, allowing more insights to be effectively derived through a clearer understanding of both ends of the spectrum.\nMy Urban Science second major is an encapsulates my academic journey and interests in the analysis, exploitation and application of data in the context of the city and built environment.\n\n\n\nMore About This Site\n\n\n\n\n\n\n\nWarning\n\n\n\nThis site is still a work in progress!\n\n\n\n\n\n\n\nKey Information\n\n\nProjects and HighlightsEducationExperience\n\n\n\nxx\n\n\n\nBSc Information Systems - Singapore Management University (2021 - 2025)\n\nFirst Major in Digitalisation and Cloud Solutions and Business Analytics\nSecond Major in Urban Science\n\nUrban Planning, Design, Geospatial Analytics, Data Science\n\n\nExchange Programme - University of Leeds (2024)\n\nGeography and Transport Studies\n\nUrban Transformation, Transport Policy, Transport and Social Psychology\n\n\nDip Architecture - Singapore Polytechnic (2016 - 2019)\n\nArchitecture\n\nBuilt Environment, Architecture, Sustainability\n\n\n\n\nData Science Intern - Urban Redevelopment Authority of Singapore (May 2023 - July 2023)\nNational Service - Republic of Singapore Air Force (May 2019 - May 2021)\nTechnical Assistant - Land Transport Authority Singapore (May 2022 - Aug 2022, Apr 2019 - May 2019)\nProject Management Intern - Land Transport Authority Singapore (Mar 2018 - Jun 2018)\n\n\n\n\n\n\n\nFind Me\n\nConnect with me on LinkedIn or contact me through email!"
  },
  {
    "objectID": "portfolio.html",
    "href": "portfolio.html",
    "title": "Portfolio",
    "section": "",
    "text": "Nothing here for now!\n\n\n\n\n\n\nWarning\n\n\n\nThis site is still a work in progress!"
  },
  {
    "objectID": "readme.html",
    "href": "readme.html",
    "title": "UrbanCoalesce",
    "section": "",
    "text": "UrbanCoalesce\nThis repository contains the Quarto and assets for the renjieteo.comwebsite"
  },
  {
    "objectID": "explore/fyp_preprocessing.html",
    "href": "explore/fyp_preprocessing.html",
    "title": "Preprocessing of OSM Building Data (HDB)",
    "section": "",
    "text": "XX"
  },
  {
    "objectID": "explore/fyp_preprocessing.html#background",
    "href": "explore/fyp_preprocessing.html#background",
    "title": "Preprocessing of OSM Building Data (HDB)",
    "section": "",
    "text": "XX"
  },
  {
    "objectID": "explore/fyp_preprocessing.html#setting-up",
    "href": "explore/fyp_preprocessing.html#setting-up",
    "title": "Preprocessing of OSM Building Data (HDB)",
    "section": "2.1 Setting Up",
    "text": "2.1 Setting Up\nPackages required to be loaded for\n\npacman::p_load(dplyr, readr, sf, tidyverse, tmap, sfdep, ggplot2, plotly, spdep, rjson, osmextract, geojsonR, rvest, httr, jsonlite, onemapsgapi)"
  },
  {
    "objectID": "explore/fyp_preprocessing.html#data-sources",
    "href": "explore/fyp_preprocessing.html#data-sources",
    "title": "Preprocessing of OSM Building Data (HDB)",
    "section": "2.2 Data Sources",
    "text": "2.2 Data Sources\n\n\n\nDataset Name\nSource\nMethodology\n\n\n\n\nHDB Existing Buildings\nData.gov.sg\nDownload\n\n\nHDB Property Information (4 Aug 2024)\nData.gov.sg\nDownload\n\n\nURA Master Plan 2019 Land Use (3 Jul 2023)\nData.gov.sg\nDownload\n\n\nHumanitarian OSM Team Buildings Dataset (1 July 2024)\nHOTOSM\nDownload"
  },
  {
    "objectID": "explore/fyp_preprocessing.html#loading-data",
    "href": "explore/fyp_preprocessing.html#loading-data",
    "title": "Preprocessing of OSM Building Data (HDB)",
    "section": "3.1 Loading Data",
    "text": "3.1 Loading Data\nLoading HDB Property Information (4 Aug 2024)\n\nRAW_HDB_PROPERTY &lt;- read.csv(\"data/fyp_preprocessing/HDBPropertyInformation.csv\")\n\nLoading HDB Existing Buildings KML\nhttps://stackoverflow.com/questions/50775357/how-to-read-in-kml-file-properly-in-r-or-separate-out-lumped-variables-into-col\n\nraw_hdb_bldgs = st_read(\"data/fyp_preprocessing/HDBExistingBuilding.geojson\")\n\nReading layer `HDBExistingBuilding' from data source \n  `C:\\Users\\renji\\OneDrive - Singapore Management University\\0_git-projects\\urbancoalesce\\explore\\data\\fyp_preprocessing\\HDBExistingBuilding.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 12847 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY, XYZ\nBounding box:  xmin: 103.6848 ymin: 1.270005 xmax: 103.989 ymax: 1.457245\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n\nattributes &lt;- lapply(X = 1:nrow(raw_hdb_bldgs), \n                     FUN = function(x) {\n\n                       raw_hdb_bldgs %&gt;% \n                         slice(x) %&gt;%\n                         pull(Description) %&gt;%\n                         read_html() %&gt;%\n                         html_node(\"table\") %&gt;%\n                         html_table(header = TRUE, trim = TRUE, dec = \".\", fill = TRUE) %&gt;%\n                         as_tibble(.name_repair = ~ make.names(c(\"Attribute\", \"Value\"))) %&gt;% \n                         pivot_wider(names_from = Attribute, values_from = Value)\n\n                     })\n\nhdb_bldgs &lt;- \n  raw_hdb_bldgs %&gt;%\n  bind_cols(bind_rows(attributes)) %&gt;%\n  select(-Description)\n\nLoading Humanitarian OSM Buildings Dataset (1 July 2024)\n\nhotosm_bldgs &lt;- st_read(dsn = \"data/fyp_preprocessing/HOTOSM_BLDGS\",\n                   layer = \"hotosm_sgp_buildings_polygons_shp\") \n\nReading layer `hotosm_sgp_buildings_polygons_shp' from data source \n  `C:\\Users\\renji\\OneDrive - Singapore Management University\\0_git-projects\\urbancoalesce\\explore\\data\\fyp_preprocessing\\HOTOSM_BLDGS' \n  using driver `ESRI Shapefile'\nSimple feature collection with 116220 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 103.6059 ymin: 1.159946 xmax: 104.0593 ymax: 1.456348\nCRS:           NA\n\n#%&gt;%\n#  st_transform(crs = 3414)\n\nTO-DO: EXTRACT HOTOSM DATA BASED ON MP19 LAND USE POLYGON = RESIDENTIAL (CAN SELECT HDB ONLY?)\nTo verify whether to use OSM or HOTOSM data for buildings\nPlotting HDB Existing Buildings dataset\n\ntmap_options(check.and.fix = TRUE)\ntmap_mode(\"plot\")\ntm_shape(hdb_bldgs) +\n  tm_fill(col = \"brown\")\n\n\n\n\n\n\n\n\nAdding Postal Codes to HDB Property Datasets - prepare to combine with HDB Buildings geospatial data\nRef https://renjieteo-is415.netlify.app/exercises/thex03#create-a-list-storing-unique-addressespostal-codeshttps://renjieteo-is415.netlify.app/exercises/thex03#create-a-list-storing-unique-addressespostal-codes\n\nHDB_PROPERTY &lt;- RAW_HDB_PROPERTY %&gt;%\n  mutate(RAW_HDB_PROPERTY, address = paste(blk_no, street))\n\n\nget_postal &lt;- function(addr_lst){\n  \n  # Create a data frame to store all retrieved coordinates\n  new_postal &lt;- data.frame()\n  i = 0\n  for (addr in addr_lst){\n    i = i + 1\n    print(c(addr, as.character(i)))\n\n    reply &lt;- GET('https://www.onemap.gov.sg/api/common/elastic/search?',\n           query = list(searchVal = addr,\n                        returnGeom = 'N',\n                        getAddrDetails = 'Y'))\n    \n    output &lt;- fromJSON(rawToChar(reply$content))\n    found &lt;- output$found\n    res &lt;- output$results\n    \n    # Create a new data frame for each address\n    new_row &lt;- data.frame()\n    \n    # If single result, append \n    if (found &gt;= 1){\n      res_1 &lt;- head(res, n = 1)\n      postal &lt;- res_1$POSTAL\n      new_row &lt;- data.frame(address = addr, postal = postal)\n    }\n\n    else {\n      new_row &lt;- data.frame(address = addr, postal = NA)\n    }\n    \n    # Add the row\n    new_postal &lt;- rbind(new_postal, new_row)\n  }\n  return(new_postal)\n}\n\nObtain postal codes from OneMap API\n\naddr_lst &lt;- sort(unique(HDB_PROPERTY$address))\npostal &lt;- get_postal(addr_lst)\n\nwrite_rds(postal, \"data/fyp_preprocessing/hdb_property_postal.rds\")\n\nCombine HDB Property data to HDB Buildings dataset\n\ntemp_hdb &lt;- left_join(hdb_bldgs, postal, by=c(\"Postal\" = \"Postal\"))"
  }
]